//
//  Project.swift
//  FSNotes
//
//  Created by Oleksandr Glushchenko on 4/7/18.
//  Copyright © 2018 Oleksandr Glushchenko. All rights reserved.
//

import Foundation

class Project: Equatable {
    var url: URL
    var label: String
    var isTrash: Bool
    var isCloudDrive: Bool = false
    var isRoot: Bool
    var parent: Project?
    var isDefault: Bool

    init(url: URL, label: String? = nil, isTrash: Bool = false, isRoot: Bool = false, parent: Project? = nil, isDefault: Bool = false) {
        self.url = url
        self.isTrash = isTrash
        self.isRoot = isRoot
        self.parent = parent
        self.isDefault = isDefault

        if let l = label {
            self.label = l
        } else {
            self.label = url.lastPathComponent
        }

        isCloudDrive = isCloudDriveFolder(url: url)
    }

    func fileExist(fileName: String, ext: String) -> Bool {
        let fileURL = url.appendingPathComponent(fileName + "." + ext)

        return FileManager.default.fileExists(atPath: fileURL.path)
    }

    static func == (lhs: Project, rhs: Project) -> Bool {
        return lhs.url == rhs.url
    }

    private func isCloudDriveFolder(url: URL) -> Bool {
        if let iCloudDocumentsURL = FileManager.default.url(forUbiquityContainerIdentifier: nil)?.appendingPathComponent("Documents") {

            if FileManager.default.fileExists(atPath: iCloudDocumentsURL.path, isDirectory: nil), url.path.contains(iCloudDocumentsURL.path) {
                return true
            }
        }

        return false
    }

    public func getParent() -> Project {
        if isRoot {
            return self
        }

        if let parent = self.parent {
            return parent.getParent()
        }

        return self
    }

    public func getFullLabel() -> String {
        if isRoot {
            return label
        }

        return "\(getParent().getFullLabel()) › \(label)"
    }
}
